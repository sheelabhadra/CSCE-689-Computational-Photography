clear; clc; 

%%% Assignment 4 - Starter code

% Setting up the input output paths and the parameters
inputDir = '../Images/';
outputDir = '../Results/';

lambda = 50;
Zmin = 0;
Zmax = 255;

calibSetName = '0_Calib_Chapel';

% Parsing the input images to get the file names and corresponding exposure
% values
[filePaths, exposures, numExposures] = ParseFiles([inputDir, '/', calibSetName]);

% Sample the images
N = 5*256/(numel(filePaths)-1);
[imgH, imgW] = size(imread(filePaths(1)));
Z = zeros(imgH*imgW, numel(filePaths));


for j=1:numel(filePaths)
    i = randi([1, imgH*imgW]);
    img = imread(filePaths(j));
    Z(j) = img(i,i);
end

% Recover the camera response function using Debevec's optimization code (gsolve.m)
[g, lE] = gsolve(Z, exposures, lambda, @triangle_function, Zmin, Zmax);

% Create the triangle function
function [w] = triangle_function(Z)
    if Z >= 0 && Z < 127.5
        w = Z/127.5;
    else
        w = (255 - Z)/127.5;
    end
end



